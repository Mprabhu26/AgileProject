<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${project.name} + ' - Staffing | Resource Planner'">Project Staffing</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f1f5f9;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #8b5cf6;
        }
        .header h1 {
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .project-meta {
            display: flex;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .meta-item {
            display: flex;
            flex-direction: column;
        }
        .meta-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .meta-value {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }
        .alert-success {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        .alert-warning {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
        .alert-info {
            background: #e0f2fe;
            border-color: #0ea5e9;
            color: #0369a1;
        }
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        @media (max-width: 1200px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }
        .card-title {
            font-size: 18px;
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #f8fafc;
            font-weight: 600;
            color: #475569;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:hover {
            background: #f8fafc;
        }
        .skill-tag {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin: 2px;
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            text-transform: uppercase;
        }
        .bg-green {
            background: #d1fae5;
            color: #065f46;
        }
        .bg-yellow {
            background: #fef3c7;
            color: #92400e;
        }
        .bg-red {
            background: #fee2e2;
            color: #991b1b;
        }
        .bg-blue {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .btn-success {
            background: #10b981;
            color: white;
        }
        .btn-success:hover {
            background: #059669;
        }
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        .btn-warning:hover {
            background: #d97706;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-back {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
        }
        .btn-back:hover {
            background: #e2e8f0;
        }
        .btn-external {
            background: #8b5cf6;
            color: white;
        }
        .btn-external:hover {
            background: #7c3aed;
        }
        .employee-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s;
        }
        .employee-card:hover {
            border-color: #c7d2fe;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .employee-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .employee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }
        .employee-info h4 {
            font-size: 16px;
            color: #1e293b;
            margin-bottom: 4px;
        }
        .employee-info p {
            font-size: 13px;
            color: #64748b;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #94a3b8;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        .progress-bar-container {
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 500px;
            max-width: 90%;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }
        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        .external-search-section {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #0ea5e9;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <h1>
                    <i class="fas fa-user-plus"></i>
                    Staffing: <span th:text="${project.name}">Project Name</span>
                </h1>
                <p th:text="${project.description ?: 'No description available'}">Project description</p>

                <div class="project-meta">
                    <div class="meta-item">
                        <div class="meta-label">Required Positions</div>
                        <div class="meta-value" th:text="${project.totalEmployeesRequired} + ' people'">5 people</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Currently Staffed</div>
                        <div class="meta-value" th:text="${currentAssignments != null ? currentAssignments.size() : 0} + ' people'">2 people</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Timeline</div>
                        <div class="meta-value">
                            <span th:text="${#temporals.format(project.startDate, 'MMM dd, yyyy')}">Jan 15, 2025</span> -
                            <span th:text="${#temporals.format(project.endDate, 'MMM dd, yyyy')}">Jun 30, 2025</span>
                        </div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Status</div>
                        <div class="meta-value">
                            <span th:class="${'status-badge ' + (project.status.name() == 'APPROVED' ? 'bg-green' : (project.status.name() == 'PENDING' ? 'bg-yellow' : 'bg-red'))}"
                                  th:text="${project.status}">APPROVED</span>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <a href="/ui/resource-planner/dashboard" class="btn btn-back">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar-container">
            <div class="progress-bar"
                 th:style="'width: ' + ${(currentAssignments != null ? currentAssignments.size() : 0) / project.totalEmployeesRequired * 100} + '%;'"></div>
        </div>
        <div style="text-align: center; color: #64748b; font-size: 14px; margin-top: 10px;">
            <span th:text="${#numbers.formatDecimal((currentAssignments != null ? currentAssignments.size() : 0) / project.totalEmployeesRequired * 100, 1, 1)}">40</span>% staffed
            • Need <span th:text="${project.totalEmployeesRequired - (currentAssignments != null ? currentAssignments.size() : 0)}">3</span> more employees
        </div>

        <!-- External Search Section -->
        <div class="external-search-section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="color: #0369a1; margin-bottom: 5px;">
                        <i class="fas fa-globe"></i> External Talent Search
                    </h4>
                    <p style="color: #64748b; font-size: 13px;">
                        Find candidates from external job boards and platforms
                    </p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <form th:action="@{'/ui/resource-planner/project/' + ${project.id} + '/external-search'}"
                          method="post" style="margin: 0;">
                        <button type="submit" class="btn btn-external"
                                th:disabled="${project.externalSearchNeeded}">
                            <i class="fas fa-search"></i>
                            <span th:if="${project.externalSearchNeeded}">
                                <i class="fas fa-sync-alt fa-spin"></i> Search in Progress
                            </span>
                            <span th:if="${not project.externalSearchNeeded}">
                                Start External Search
                            </span>
                        </button>
                    </form>

                    <a th:href="@{'/ui/resource-planner/project/' + ${project.id} + '/external-candidates'}"
                       class="btn btn-primary" th:if="${project.externalSearchNeeded}">
                        <i class="fas fa-user-tie"></i> View External Candidates
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    <div th:if="${#ctx.containsVariable('success')}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${success}"></span>
    </div>

    <div th:if="${#ctx.containsVariable('warning')}" class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${warning}"></span>
    </div>

    <div th:if="${#ctx.containsVariable('info')}" class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        <span th:text="${info}"></span>
    </div>

    <!-- Two Column Layout -->
    <div class="two-column">
        <!-- Current Assignments -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-user-check"></i>
                Current Team (<span th:text="${currentAssignments != null ? currentAssignments.size() : 0}">0</span>)
            </div>

            <div th:if="${currentAssignments != null and not currentAssignments.isEmpty()}">
                <table>
                    <thead>
                    <tr>
                        <th>Employee</th>
                        <th>Department</th>
                        <th>Skills</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="assignment : ${currentAssignments}">
                        <td>
                            <strong th:text="${assignment.employee.name}">John Doe</strong><br>
                            <small style="color: #64748b;" th:text="${assignment.employee.email}">john@example.com</small>
                        </td>
                        <td th:text="${assignment.employee.department}">Engineering</td>
                        <td>
                            <div th:each="skill : ${assignment.employee.skills}">
                                <span class="skill-tag" th:text="${skill}">Java</span>
                            </div>
                            <span th:if="${assignment.employee.skills == null or assignment.employee.skills.isEmpty()}"
                                  style="color: #94a3b8; font-style: italic;">No skills</span>
                        </td>
                        <td>
                            <span th:class="${'status-badge ' + (assignment.status.name() == 'PENDING' ? 'bg-yellow' : (assignment.status.name() == 'ASSIGNED' ? 'bg-green' : (assignment.status.name() == 'IN_PROGRESS' ? 'bg-blue' : 'bg-red')))}"
                                  th:text="${assignment.status}">ASSIGNED</span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                <form th:action="@{'/ui/resource-planner/assignment/' + ${assignment.id} + '/remove'}"
                                      method="post" style="display: inline;">
                                    <button type="submit" class="btn btn-danger remove-btn"
                                            th:attr="data-employee-name=${assignment.employee.name}"
                                            th:disabled="${assignment.status.name() != 'PENDING'}">
                                        <i class="fas fa-user-minus"></i> Remove
                                    </button>
                                </form>
                                <button th:if="${assignment.status.name() == 'PENDING'}"
                                        class="btn btn-warning cancel-proposal-btn"
                                        th:attr="data-assignment-id=${assignment.id}"
                                        th:data-employee-name="${assignment.employee.name}">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div th:if="${currentAssignments == null or currentAssignments.isEmpty()}" class="empty-state">
                <i class="fas fa-user-slash"></i>
                <h3>No Employees Assigned Yet</h3>
                <p>Start by proposing employees from the matching candidates.</p>
            </div>
        </div>

        <!-- Matching Employees -->
        <div class="card">
            <div class="card-title">
                <i class="fas fa-users"></i>
                Matching Candidates (<span th:text="${matchingEmployees != null ? matchingEmployees.size() : 0}">0</span>)
            </div>

            <!-- Skill Requirements -->
            <div th:if="${project.skillRequirements != null and not project.skillRequirements.isEmpty()}"
                 style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                <div style="font-weight: 600; color: #1e293b; margin-bottom: 10px;">
                    <i class="fas fa-bullseye"></i> Required Skills:
                </div>
                <div>
                    <span th:each="skillReq : ${project.skillRequirements}" class="skill-tag">
                        <i class="fas fa-tag"></i>
                        <span th:text="${skillReq.skill}">Java</span>
                        <span th:if="${skillReq.requiredCount > 1}"
                              th:text="'(' + ${skillReq.requiredCount} + ')'">(2)</span>
                    </span>
                </div>
            </div>


            <div th:if="${project.skillRequirements != null and not project.skillRequirements.isEmpty()}"
                 style="margin: 20px 0; padding: 15px; background: #fff8e1; border-radius: 8px; border-left: 4px solid #ff9800;">

                <h4 style="color: #e65100; margin-bottom: 15px;">
                    <i class="fas fa-chart-line"></i> Skill Gap Analysis
                </h4>

                <!-- Skill Coverage Progress -->
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-weight: 500; color: #5d4037;">Skill Coverage</span>
                        <span style="font-weight: 600; color: #388e3c;">
                            <span th:text="${skillCoveragePercentage != null ? #numbers.formatDecimal(skillCoveragePercentage, 1, 1) : 100}">100</span>%
                        </span>
                    </div>
                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                        <div th:with="coverage=${skillCoveragePercentage != null ? skillCoveragePercentage : 100},
                                      color=${coverage >= 80 ? '#4caf50' : (coverage >= 50 ? '#ff9800' : '#f44336')}"
                             th:style="'width: ' + ${coverage} + '%; height: 100%; background: ' + ${color} + ';'">
                        </div>
                    </div>
                </div>

                <!-- Detailed Gap Analysis -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div th:each="gapEntry : ${skillGaps}"
                         th:with="isPositive=${gapEntry.value >= 0}"
                         th:style="'background: ' + ${isPositive ? '#e8f5e8' : '#ffebee'} + '; padding: 12px; border-radius: 6px; border-left: 3px solid ' + ${isPositive ? '#4caf50' : '#f44336'} + ';'">
                        <div style="font-weight: 600; color: #424242;" th:text="${gapEntry.key}">Java</div>
                        <div style="font-size: 14px; color: #616161;">
                            Required: <span th:text="${helpers.getRequiredCount.apply(project, gapEntry.key)}">3</span> |
                            Available: <span th:text="${helpers.getAvailableCount.apply(project, gapEntry.key, availableEmployeesForGap)}">2</span>
                        </div>
                        <div th:if="${gapEntry.value >= 0}" style="color: #2e7d32; font-weight: 500;">
                            <i class="fas fa-check-circle"></i> +<span th:text="${gapEntry.value}">1</span> surplus
                        </div>
                        <div th:if="${gapEntry.value < 0}" style="color: #d32f2f; font-weight: 500;">
                            <i class="fas fa-exclamation-circle"></i> <span th:text="${-gapEntry.value}">1</span> shortage
                        </div>
                    </div>
                </div>

                <!-- Recommended Actions -->
                <div th:if="${recommendedActions != null and not recommendedActions.isEmpty()}">
                    <h5 style="color: #5d4037; margin-bottom: 10px;">
                        <i class="fas fa-lightbulb"></i> Recommended Actions
                    </h5>
                    <ul style="margin: 0; padding-left: 20px; color: #616161;">
                        <li th:each="action : ${recommendedActions}" th:text="${action}"></li>
                    </ul>
                </div>
            </div>

            <!-- Employee Cards -->
            <div th:if="${matchingEmployees != null and not matchingEmployees.isEmpty()}">
                <div th:each="employee : ${matchingEmployees}" class="employee-card">
                    <div class="employee-header">
                        <div class="employee-avatar" th:text="${#strings.substring(employee.name, 0, 1)}">J</div>
                        <div class="employee-info">
                            <h4 th:text="${employee.name}">John Doe</h4>
                            <p>
                                <i class="fas fa-building"></i>
                                <span th:text="${employee.department}">Engineering</span>
                                •
                                <i class="fas fa-envelope"></i>
                                <span th:text="${employee.email}">john@example.com</span>
                            </p>
                        </div>
                    </div>

                    <div style="margin-bottom: 15px;">
                        <strong style="font-size: 13px; color: #64748b;">Skills:</strong>
                        <div>
                            <span th:each="skill : ${employee.skills}" class="skill-tag" th:text="${skill}">Java</span>
                            <span th:if="${employee.skills == null or employee.skills.isEmpty()}"
                                  style="color: #94a3b8; font-style: italic;">No skills</span>
                        </div>
                    </div>

                    <div>
                        <button class="btn btn-success propose-btn"
                                th:data-employee-id="${employee.id}"
                                th:data-employee-name="${employee.name}"
                                th:disabled="${!employee.available}">
                            <i class="fas fa-user-plus"></i>
                            <span th:text="${employee.available ? 'Propose for Project' : 'Not Available'}">Propose for Project</span>
                        </button>
                    </div>
                </div>
            </div>
            <div th:if="${matchingEmployees == null or matchingEmployees.isEmpty()}" class="empty-state">
                <i class="fas fa-search"></i>
                <h3>No Matching Employees Found</h3>
                <p>Try searching for employees with different skills.</p>
                <a href="/ui/resource-planner/search" class="btn btn-primary" style="margin-top: 15px;">
                    <i class="fas fa-search"></i> Search All Employees
                </a>
            </div>
        </div>
    </div>

    <!-- Pending Applications -->
    <div class="card">
        <div class="card-title">
            <i class="fas fa-clock"></i>
            Pending Applications (<span th:text="${pendingApplications != null ? pendingApplications.size() : 0}">0</span>)
        </div>

        <div th:if="${pendingApplications != null and not pendingApplications.isEmpty()}">
            <table>
                <thead>
                <tr>
                    <th>Employee</th>
                    <th>Applied On</th>
                    <th>Message</th>
                    <th>Skills</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="app : ${pendingApplications}">
                    <td>
                        <strong th:text="${app.employee.name}">John Doe</strong><br>
                        <small style="color: #64748b;" th:text="${app.employee.department}">Engineering</small>
                    </td>
                    <td th:text="${#temporals.format(app.appliedAt, 'MMM dd, yyyy HH:mm')}">Jan 15, 2025</td>
                    <td>
                        <span th:if="${app.message}" th:text="${#strings.abbreviate(app.message, 100)}">Message...</span>
                        <span th:if="${app.message == null}" style="color: #94a3b8; font-style: italic;">No message</span>
                    </td>
                    <td>
                        <div th:each="skill : ${app.employee.skills}">
                            <span class="skill-tag" th:text="${skill}">Java</span>
                        </div>
                        <span th:if="${app.employee.skills == null or app.employee.skills.isEmpty()}"
                              style="color: #94a3b8; font-style: italic;">No skills</span>
                    </td>
                    <td>
                        <button class="btn btn-success propose-btn"
                                th:data-employee-id="${app.employee.id}"
                                th:data-employee-name="${app.employee.name}"
                                th:disabled="${!app.employee.available}">
                            <i class="fas fa-check"></i> Propose
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div th:if="${pendingApplications == null or pendingApplications.isEmpty()}" class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>No Pending Applications</h3>
            <p>Employees haven't applied to this project yet.</p>
        </div>
    </div>
</div>

<!-- Proposal Modal -->
<div id="proposalModal" class="modal">
    <div class="modal-content">
        <h2 style="margin-bottom: 20px; color: #1e293b;">
            <i class="fas fa-user-plus"></i>
            Propose Employee for Project
        </h2>

        <form id="proposalForm" method="post" th:action="@{'/ui/resource-planner/project/' + ${project.id} + '/propose'}">
            <input type="hidden" id="proposalEmployeeId" name="employeeId">

            <div class="form-group">
                <label for="employeeName">Employee</label>
                <input type="text" id="employeeName" class="form-control" readonly>
            </div>

            <div class="form-group">
                <label for="projectName">Project</label>
                <input type="text" id="projectName" class="form-control" th:value="${project.name}" readonly>
            </div>

            <div class="form-group">
                <label for="proposalNotes">
                    <i class="fas fa-sticky-note"></i>
                    Notes (Optional)
                </label>
                <textarea id="proposalNotes" name="notes" class="form-control"
                          rows="4" placeholder="Add notes about why this employee is a good match..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-back" onclick="closeModal()">
                    Cancel
                </button>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-paper-plane"></i>
                    Submit Proposal
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Modal functions
    function openProposalModal(employeeId, employeeName) {
        document.getElementById('proposalEmployeeId').value = employeeId;
        document.getElementById('employeeName').value = employeeName;
        document.getElementById('proposalModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('proposalModal').style.display = 'none';
        document.getElementById('proposalForm').reset();
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('proposalModal');
        if (event.target === modal) {
            closeModal();
        }
    };

    // Handle remove confirmation
    document.addEventListener('DOMContentLoaded', function() {
        const removeButtons = document.querySelectorAll('.remove-btn');
        removeButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                if (this.disabled) {
                    event.preventDefault();
                    return;
                }
                const employeeName = this.getAttribute('data-employee-name');
                const confirmed = confirm('Remove ' + employeeName + ' from project?');
                if (!confirmed) {
                    event.preventDefault();
                }
            });
        });

        // Handle propose buttons
        const proposeButtons = document.querySelectorAll('.propose-btn');
        proposeButtons.forEach(button => {
            button.addEventListener('click', function() {
                if (this.disabled) return;

                const employeeId = this.getAttribute('data-employee-id');
                const employeeName = this.getAttribute('data-employee-name');
                openProposalModal(employeeId, employeeName);
            });
        });

        // Handle cancel proposal buttons
        const cancelButtons = document.querySelectorAll('.cancel-proposal-btn');
        cancelButtons.forEach(button => {
            button.addEventListener('click', function() {
                const assignmentId = this.getAttribute('data-assignment-id');
                const employeeName = this.getAttribute('data-employee-name');

                if (confirm('Cancel proposal for ' + employeeName + '?')) {
                    fetch('/ui/resource-planner/assignment/' + assignmentId + '/cancel', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        }
                    }).then(response => {
                        if (response.ok) {
                            location.reload();
                        } else {
                            alert('Failed to cancel proposal');
                        }
                    }).catch(error => {
                        console.error('Error:', error);
                        alert('Failed to cancel proposal');
                    });
                }
            });
        });
    });
</script>
</body>
</html>
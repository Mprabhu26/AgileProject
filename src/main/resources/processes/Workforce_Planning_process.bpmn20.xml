<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/bpmn"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
             targetNamespace="http://www.flowable.org/processdef">

  <process id="workforcePlanningProcess"
           name="Workforce Planning Process"
           isExecutable="true">

    <!-- Start -->
    <startEvent id="startEvent" name="Start" />
    <sequenceFlow id="flow1" sourceRef="startEvent" targetRef="projectStartTask" />

    <!-- Project creation -->
    <serviceTask id="projectStartTask"
                 name="Create Project"
                 flowable:class="com.workforce.workforceplanning.workflow.ProjectStartDelegate" />
    <sequenceFlow id="flow2" sourceRef="projectStartTask" targetRef="projectApprovalTask" />

    <!-- Approval -->
    <userTask id="projectApprovalTask"
              name="Approve Project"
              flowable:assignee="${departmentHead}" />
    <sequenceFlow id="flow3" sourceRef="projectApprovalTask" targetRef="approvalGateway" />

    <!-- Decision gateway -->
    <exclusiveGateway id="approvalGateway" name="Approval Decision" />

    <!-- Approved path -->
    <sequenceFlow id="approvedFlow"
                  sourceRef="approvalGateway"
                  targetRef="assignmentTask">
      <conditionExpression xsi:type="tFormalExpression">
        ${approved == true}
      </conditionExpression>
    </sequenceFlow>

    <!-- Rejected path -->
    <sequenceFlow id="rejectedFlow"
                  sourceRef="approvalGateway"
                  targetRef="rejectEnd">
      <conditionExpression xsi:type="tFormalExpression">
        ${approved == false}
      </conditionExpression>
    </sequenceFlow>

    <!-- Assignment -->
    <serviceTask id="assignmentTask"
                 name="Assign Employees"
                 flowable:class="com.workforce.workforceplanning.workflow.AssignmentDelegate" />
    <sequenceFlow id="flow7" sourceRef="assignmentTask" targetRef="notificationTask" />

    <!-- Notifications -->
    <serviceTask id="notificationTask"
                 name="Send Notifications"
                 flowable:class="com.workforce.workforceplanning.workflow.NotificationDelegate" />
    <sequenceFlow id="flow8" sourceRef="notificationTask" targetRef="projectCompletionTask" />

    <!-- Completion -->
    <serviceTask id="projectCompletionTask"
                 name="Complete Project"
                 flowable:class="com.workforce.workforceplanning.workflow.ProjectCompletionDelegate" />
    <sequenceFlow id="flow9" sourceRef="projectCompletionTask" targetRef="endEvent" />

    <!-- End -->
    <endEvent id="endEvent" name="Completed" />
    <endEvent id="rejectEnd" name="Rejected" />

    <!-- Event Subprocess (kept intact) -->
    <subProcess id="unpublishSubProcess" triggeredByEvent="true">
      <startEvent id="unpublishStart">
        <messageEventDefinition messageRef="unpublishMessage" />
      </startEvent>

      <serviceTask id="unpublishTask"
                   name="Unpublish Project"
                   flowable:class="com.workforce.workforceplanning.workflow.ProjectUnpublishDelegate" />

      <endEvent id="unpublishEnd" />
      <sequenceFlow id="unpublishFlow1" sourceRef="unpublishStart" targetRef="unpublishTask" />
      <sequenceFlow id="unpublishFlow2" sourceRef="unpublishTask" targetRef="unpublishEnd" />
    </subProcess>

  </process>

  <!-- Message -->
  <message id="unpublishMessage" name="UnpublishProject" />

</definitions>
